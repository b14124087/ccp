<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬16å±†è·æ¶¯æ•™ç·´è¨ˆç•« - å†’éšªå•Ÿç¨‹</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=DotGothic16&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Canvas Confetti (ç…™ç«ç‰¹æ•ˆç”¨) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #11111b; 
            --accent-color: #f7d51d;
            --ui-blue: #3b5dc9;
            --boss-red: #ff3333;
        }

        body {
            background-color: var(--bg-dark);
            font-family: 'DotGothic16', sans-serif; 
            color: #333;
            overflow-x: hidden;
            cursor: url('https://cur.cursors-4u.net/cursors/cur-10/cur964.cur'), auto;
        }

        /* è®“æ‰€æœ‰å¯äº’å‹•å…ƒç´ çš„æ¸¸æ¨™ä¹Ÿè®ŠæˆåŠ */
        a, button, .company-grid-item, .close-btn, .gacha-folder, .pixel-btn, .boss-grid-item {
            cursor: url('https://cur.cursors-4u.net/cursors/cur-10/cur964.cur'), pointer; 
        }

        /* --- å…¨ç«™é€šç”¨çš„å‹•æ…‹åƒç´ èƒŒæ™¯ --- */
        #global-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; 
            background-color: var(--bg-dark);
            background-image: url('./image/background.png'); 
            background-size: 110% 110%; 
            background-position: center;
            image-rendering: pixelated; 
            animation: bg-pan 20s ease-in-out infinite alternate;
            transition: background-image 0.5s ease-in-out, filter 0.2s ease;
        }

        /* BOSS æ¨¡å¼èƒŒæ™¯ */
        #global-bg.boss-mode {
            background-image: url('./image/boss.png'); 
            filter: contrast(1.1) brightness(0.8);
        }

        /* å—å‚·é–ƒçˆèƒŒæ™¯ */
        #global-bg.damage-mode {
            filter: sepia(1) hue-rotate(-50deg) saturate(5) contrast(2);
        }

        #global-bg::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.1) 51%);
            background-size: 100% 4px;
            animation: scanline-move 60s linear infinite;
            pointer-events: none;
        }

        #global-bg::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 50%, #000 95%);
            z-index: 1;
            pointer-events: none;
        }

        @keyframes bg-pan { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        @keyframes scanline-move { 0% { background-position: 0 0; } 100% { background-position: 0 1000px; } }

        .en-pixel { font-family: 'Press Start 2P', cursive; }
        h1, h2, h3, .pixel-font { font-family: 'DotGothic16', sans-serif; line-height: 1.5; }

        .pixel-box {
            background: white;
            border: 4px solid black;
            padding: 1rem;
            box-shadow: 4px 4px 0px 0px rgba(0,0,0,1); 
        }

        .force-pixel { image-rendering: pixelated; }

        .rpg-dialogue {
            background-color: var(--ui-blue);
            color: white;
            border: 4px solid white;
            outline: 4px solid black;
            padding: 15px;
            position: relative;
            box-shadow: 4px 4px 0 0 rgba(0,0,0,0.5);
        }
        
        .pixel-btn {
            background-color: var(--accent-color);
            border: 4px solid black;
            font-family: 'Press Start 2P', 'DotGothic16', cursive; 
            padding: 12px 24px;
            text-transform: uppercase;
            box-shadow: inset -4px -4px 0px 0px rgba(0,0,0,0.2), 4px 4px 0px 0px #000;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .pixel-btn:active { transform: translate(4px, 4px); box-shadow: none; }
        .pixel-btn:hover { background-color: #ffe066; }

        .company-grid-item {
            background-color: #f0f0f0;
            border: 4px solid #555;
            transition: all 0.1s;
            position: relative;
        }
        .company-grid-item:hover {
            border-color: var(--accent-color);
            transform: scale(1.05);
            background-color: #fff;
            box-shadow: 0 0 15px var(--accent-color);
            z-index: 10;
        }

        .hidden-screen { display: none !important; }

        /* å¡ç‰‡é€²å ´å½ˆå‡ºå‹•ç•« */
        @keyframes popIn {
            0% { transform: scale(0.8) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .pop-in-animation {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* å‘¼å¸å‹•ç•« */
        @keyframes breathe-obj {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        .breathing-effect img, .breathing-effect video {
            animation: breathe-obj 4s ease-in-out infinite;
        }

        /* æ•…éšœæ•ˆæœ */
        @keyframes glitch-anim {
            0% { clip-path: inset(0 0 0 0); transform: translate(0); }
            2% { clip-path: inset(10% 0 85% 0); transform: translate(-2px, 2px); }
            4% { clip-path: inset(85% 0 10% 0); transform: translate(2px, -2px); }
            6% { clip-path: inset(0 0 0 0); transform: translate(0); }
            100% { clip-path: inset(0 0 0 0); transform: translate(0); }
        }
        .glitch-effect:hover img, .glitch-effect:hover video {
            animation: glitch-anim 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
        }

        .stat-bar-fill { width: 0%; transition: width 1s ease-out; }
        .cursor-blink { animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Loading Screen */
        #loading-screen {
            position: fixed; inset: 0; background-color: #000; z-index: 9999;
            display: flex; flex-col: column; align-items: center; justify-content: center;
            font-family: 'Press Start 2P', cursive; color: white;
        }
        .loading-bar-container { width: 80%; max-width: 400px; height: 30px; border: 4px solid white; padding: 4px; margin-top: 20px; }
        .loading-bar-fill { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.1s linear; }

        /* --- æŠ½å¡ç³»çµ±æ¨£å¼ --- */
        #gacha-screen {
            position: fixed; inset: 0; z-index: 60;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex; align-items: center; justify-content: center; flex-direction: column;
        }

        .gacha-folder {
            width: 160px; height: 120px; background-color: #fb923c; border: 8px solid #000;
            position: relative; box-shadow: 10px 10px 0 #000; cursor: pointer;
        }
        .gacha-folder::before {
            content: ''; position: absolute; top: -20px; left: -8px; width: 60px; height: 20px;
            background-color: #fb923c; border: 8px solid #000; border-bottom: none;
        }
        .gacha-folder::after {
            content: 'SECRET'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Press Start 2P'; font-size: 12px; color: black; background: rgba(255,255,255,0.8);
            padding: 4px; border: 2px solid black; text-align: center;
        }
        
        .gacha-idle { animation: float-folder 3s ease-in-out infinite; }
        @keyframes float-folder { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        .gacha-shake { animation: shake-hard 0.5s linear infinite; }
        @keyframes shake-hard {
            0% { transform: translate(2px, 2px) rotate(0deg); }
            25% { transform: translate(-2px, -2px) rotate(-5deg); }
            50% { transform: translate(2px, -2px) rotate(5deg); }
            75% { transform: translate(-2px, 2px) rotate(-5deg); }
            100% { transform: translate(2px, -2px) rotate(0deg); }
        }

        .gacha-flash { animation: flash-white 0.5s forwards; }
        @keyframes flash-white {
            0% { background-color: rgba(0,0,0,0.85); }
            50% { background-color: white; }
            100% { background-color: rgba(0,0,0,0.85); opacity: 0; }
        }

        /* --- ç™¼å…‰å±•ç¤º (Shiny Reveal) --- */
        #gacha-reveal {
            position: fixed; inset: 0; z-index: 55;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none;
        }
        
        .sunburst {
            position: absolute; width: 200vmax; height: 200vmax;
            background: repeating-conic-gradient(from 0deg, #f7d51d 0deg 20deg, #ffed4a 20deg 40deg);
            animation: spin 10s linear infinite;
            opacity: 0; transition: opacity 0.5s;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ä¿®æ­£ï¼šæ•™ç·´æŠ½å¡å°ºå¯¸è‡ªé©æ‡‰ 2:3 */
        .reveal-img-container {
            width: 70vw; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦ */
            max-width: 400px; /* æœ€å¤§å¯¬åº¦ */
            aspect-ratio: 2/3; /* å¼·åˆ¶ 2:3 æ¯”ä¾‹ */
            height: auto; /* é«˜åº¦è‡ªå‹• */
            z-index: 10;
            transform: scale(0); opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 8px solid white; box-shadow: 0 0 50px rgba(255, 255, 255, 0.8);
            background: white; 
        }

        .auto-remove-bg {
            mix-blend-mode: multiply; 
            filter: contrast(1.1) brightness(1.05);
        }

        img { image-rendering: auto; }
        .force-pixel { image-rendering: pixelated; }

        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #202028; }
        ::-webkit-scrollbar-thumb { background: #f7d51d; border: 2px solid #000; }

        /* --- BOSS Stage å°ˆç”¨æ¨£å¼ --- */
        #boss-stage {
            border-top: 8px solid #000;
            background-color: rgba(0, 0, 0, 0.6); 
            position: relative;
            min-height: 80vh; 
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* 6x4 Grid System */
        .boss-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 8px;
        }
        @media (min-width: 768px) {
            .boss-grid {
                grid-template-columns: repeat(6, 1fr); 
                gap: 16px;
            }
        }

        .boss-grid-item {
            aspect-ratio: 1;
            background-color: #333;
            border: 4px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #fff;
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
        }
        .boss-grid-item:hover {
            transform: scale(1.05);
            border-color: var(--boss-red);
            z-index: 5;
        }
        .boss-grid-item.cleared {
            background-color: #222;
            border-color: #000;
            pointer-events: none;
            opacity: 0.5;
        }
        .boss-grid-item.cleared::after {
            content: "âŒ";
            font-size: 48px;
            position: absolute;
            color: var(--boss-red);
            text-shadow: 2px 2px 0 #000;
        }

        /* Boss HP Bar */
        .boss-hp-container {
            width: 100%;
            height: 40px;
            background: #333;
            border: 4px solid white;
            position: relative;
            margin-bottom: 20px;
        }
        .boss-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff6600);
            width: 100%;
            transition: width 0.3s ease-out;
            position: relative;
        }
        .boss-hp-fill::after {
            content: "";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 20px 20px;
        }

        /* Question Modal */
        #question-modal {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
        }
        .question-box {
            background: var(--ui-blue);
            border: 6px solid white;
            outline: 6px solid black;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            box-shadow: 10px 10px 0 0 rgba(0,0,0,0.5);
            text-align: center;
            color: white;
        }

        /* Text Glitch Effect for Shuffle */
        @keyframes text-glitch {
            0% { transform: translate(0, 0); opacity: 1; }
            20% { transform: translate(-2px, 2px); opacity: 0.8; }
            40% { transform: translate(2px, -2px); opacity: 0.9; }
            60% { transform: translate(-1px, 1px); opacity: 0.8; }
            80% { transform: translate(1px, -1px); opacity: 1; }
            100% { transform: translate(0, 0); opacity: 1; }
        }
        .shuffling {
            animation: text-glitch 0.1s infinite;
            color: #ffff00; /* Yellow while shuffling */
        }

        /* Victory Screen */
        #victory-screen {
            background: linear-gradient(to bottom, #000046, #1cb5e0);
            z-index: 1000;
        }
        .victory-text {
            font-family: 'Press Start 2P', cursive;
            color: #f7d51d;
            text-shadow: 4px 4px 0 #000;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-30px);} 60% {transform: translateY(-15px);} }

    </style>
</head>
<body class="min-h-screen text-gray-900 selection:bg-yellow-400 selection:text-black">

    <!-- å…¨ç«™é€šç”¨å‹•æ…‹èƒŒæ™¯ -->
    <div id="global-bg"></div>

    <!-- 0. Loading Screen -->
    <section id="loading-screen">
        <h2 class="text-3xl md:text-5xl mb-6 animate-pulse en-pixel text-center">LOADING...</h2>
        <div class="loading-bar-container">
            <div id="loading-fill" class="loading-bar-fill"></div>
        </div>
        <p id="loading-text" class="text-sm md:text-xl mt-4 text-gray-400 en-pixel">INITIALIZING WORLD...</p>
    </section>

    <!-- 1. Start Screen -->
    <section id="start-screen" class="hidden-screen flex flex-col items-center justify-center h-screen text-center relative">
        <div class="z-10 bg-black bg-opacity-80 p-10 md:p-16 border-8 border-white shadow-[8px_8px_0_0_rgba(0,0,0,0.5)] max-w-[90%] md:max-w-5xl mx-4">
            <h1 class="text-4xl md:text-7xl text-yellow-400 mb-8 tracking-widest leading-relaxed pixel-font">
                ç¬¬16å±†<br>è·æ¶¯æ•™ç·´è¨ˆç•«
            </h1>
            <div class="h-2 bg-white w-full mb-8"></div>
            <p class="text-white pixel-font text-xl md:text-3xl mb-12 blink">PRESS START TO ADVENTURE</p>
            <button onclick="startGame()" class="pixel-btn text-2xl md:text-4xl w-full trigger-sound">START GAME</button>
        </div>
        <div class="absolute bottom-8 text-white text-base md:text-xl en-pixel z-10 flex gap-4 items-center">
            <span>Â© 16th Career Coach Team.</span>
        </div>
    </section>

    <!-- BGM æ§åˆ¶æŒ‰éˆ• -->
    <div class="fixed bottom-4 left-4 z-50 hidden flex flex-col gap-2" id="bgm-control">
        <button onclick="toggleFullScreen()" class="bg-gray-900 text-white border-2 border-white px-4 py-2 text-sm md:text-base en-pixel hover:bg-gray-700 shadow-md flex items-center gap-2 trigger-sound">
            <span>â›¶</span> FULLSCREEN
        </button>
        <button onclick="toggleBGM()" class="bg-gray-900 text-white border-2 border-white px-4 py-2 text-sm md:text-base en-pixel hover:bg-gray-700 shadow-md flex items-center gap-2 trigger-sound">
            <span>ğŸµ</span> <span id="bgm-status">BGM: OFF</span>
        </button>
    </div>

    <!-- 2. Main Map -->
    <section id="main-map" class="hidden-screen min-h-screen p-4 md:p-8 relative z-10">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 bg-gray-900 border-4 border-white p-6 sticky top-4 z-40 shadow-[6px_6px_0_0_#000]">
            <div class="flex items-center gap-6 mb-4 md:mb-0">
                <div class="w-16 h-16 bg-yellow-400 border-4 border-black flex items-center justify-center font-bold text-2xl en-pixel">16</div>
                <div>
                    <h2 class="text-white text-2xl md:text-4xl pixel-font tracking-widest">ä¼æ¥­å†’éšªåœ°åœ–</h2>
                    <div class="h-3 bg-green-500 w-full border-2 border-white mt-2 relative overflow-hidden">
                        <div class="absolute top-0 left-0 h-full bg-green-300 w-3/4 animate-pulse"></div>
                    </div>
                </div>
            </div>
            <div class="rpg-dialogue text-base md:text-xl en-pixel w-full md:w-auto text-center md:text-left">
                <span class="text-yellow-300">SYSTEM:</span> Click a card to summon mentor.
            </div>
        </header>

        <div id="grid-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-24">
            <!-- Grid Content -->
        </div>

        <!-- 4. BOSS Stage -->
        <section id="boss-stage" class="p-6 md:p-12 mt-12 border-4 border-white shadow-[0_0_20px_rgba(255,0,0,0.5)] transition-all duration-1000 opacity-50 grayscale">
            <div class="flex flex-col items-center mb-8">
                <h2 class="text-red-500 text-4xl md:text-6xl en-pixel mb-4 animate-pulse" style="text-shadow: 4px 4px 0 #000;">BOSS BATTLE</h2>
                <div class="w-full max-w-4xl relative">
                    <div class="flex justify-between text-white en-pixel mb-2 font-bold text-lg">
                        <span>BOSS HP</span>
                        <span id="boss-hp-text">24/24</span>
                    </div>
                    <div class="boss-hp-container">
                        <div id="boss-hp-bar" class="boss-hp-fill"></div>
                    </div>
                </div>
            </div>

            <!-- 6x4 Grid System for Boss -->
            <div class="max-w-4xl mx-auto w-full">
                <div id="boss-grid" class="boss-grid">
                    <!-- Boss Grid Items Generated by JS -->
                </div>
            </div>
            
            <div class="text-center mt-8 text-white pixel-font text-xl bg-black/50 p-2 rounded">
                <p>é»æ“Šæ ¼å­é€²è¡Œå•é¡ŒæŠ½é¸ï¼ŒæŒ‘æˆ°æˆåŠŸå³å¯å° BOSS é€ æˆå‚·å®³ï¼</p>
            </div>
        </section>

    </section>

    <!-- Question Modal (Updated with Shuffle Effect) -->
    <div id="question-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="question-box pop-in-animation">
            <h3 class="text-2xl md:text-3xl text-yellow-300 mb-6 pixel-font">MISSION</h3>
            <div class="min-h-[100px] flex items-center justify-center">
                <p id="q-text" class="text-xl md:text-2xl leading-relaxed mb-8 pixel-font text-left w-full break-words">...</p>
            </div>
            <div class="flex flex-col gap-4">
                <button id="attack-btn" onclick="submitAttack()" class="pixel-btn w-full text-xl md:text-2xl trigger-sound bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed">
                    âš”ï¸ ATTACK
                </button>
            </div>
            <button onclick="closeQuestionModal()" class="mt-6 text-sm underline text-gray-300 hover:text-white">æš«æ™‚æ’¤é€€ (CLOSE)</button>
        </div>
    </div>

    <!-- Victory Screen -->
    <div id="victory-screen" class="fixed inset-0 hidden flex flex-col items-center justify-center text-center">
        <h1 class="victory-text text-5xl md:text-8xl mb-8">VICTORY!</h1>
        <p class="text-white text-2xl md:text-4xl pixel-font mb-12">æ­å–œé€šé—œï¼è·æ¶¯å†’éšªæˆåŠŸï¼</p>
        <button onclick="location.reload()" class="pixel-btn text-2xl">PLAY AGAIN</button>
    </div>

    <!-- æŠ½å¡æª”æ¡ˆå¤¾ç•«é¢ -->
    <section id="gacha-screen" class="hidden-screen">
        <div id="gacha-folder" class="gacha-folder gacha-idle" onclick="triggerGacha()"></div>
        <p class="text-white mt-8 en-pixel blink text-xl">CLICK TO OPEN FILE</p>
    </section>

    <!-- æŠ½å¡ç™¼å…‰å±•ç¤ºç•«é¢ (Shiny Reveal) -->
    <section id="gacha-reveal" class="hidden-screen">
        <div class="sunburst"></div>
        <div id="reveal-card" class="reveal-img-container flex items-center justify-center overflow-hidden">
            <!-- ä¿®æ­£ï¼šimg æ”¹ç‚º object-contain ä»¥é©æ‡‰ä»»æ„å°ºå¯¸ -->
            <img id="reveal-img" src="" class="w-full h-full object-contain auto-remove-bg" alt="Coach Reveal">
        </div>
    </section>

    <!-- 3. Detail Screen -->
    <section id="detail-screen" class="hidden-screen fixed inset-0 z-40 overflow-y-auto bg-black/70">
        <div class="min-h-full flex items-center justify-center p-4 py-20">
            <div class="pop-in-animation bg-[#f0f0f0] border-8 border-white outline outline-4 outline-black max-w-7xl w-full relative p-6 md:p-10 shadow-[20px_20px_0_0_rgba(0,0,0,0.6)] z-50">
                
                <div class="absolute top-4 right-20 md:right-24 flex gap-3">
                    <div class="w-4 h-4 bg-red-500 rounded-full border-2 border-black"></div>
                    <div class="w-4 h-4 bg-yellow-500 rounded-full border-2 border-black"></div>
                    <div class="w-4 h-4 bg-green-500 rounded-full border-2 border-black"></div>
                </div>

                <button onclick="goBack()" class="close-btn absolute -top-6 -right-6 md:-top-8 md:-right-8 w-12 h-12 md:w-16 md:h-16 bg-red-500 border-4 border-white outline outline-4 outline-black flex items-center justify-center text-white text-2xl font-bold hover:bg-red-600 hover:scale-110 transition-transform shadow-lg z-50">
                    X
                </button>

                <div class="flex flex-col md:flex-row gap-8 md:gap-12 relative z-10">
                    <div class="w-full md:w-1/2 flex flex-col items-center">
                        <div class="bg-gray-800 p-3 border-4 border-black w-full max-w-[400px] md:max-w-none shadow-[8px_8px_0_0_rgba(0,0,0,0.3)]">
                            <div class="w-full aspect-[2/3] bg-gray-700 border-2 border-gray-600 relative overflow-hidden glitch-effect breathing-effect group cursor-pointer">
                                <div id="media-container" class="w-full h-full bg-white flex items-center justify-center"> 
                                    <img id="detail-img" src="" alt="Coach Card" class="w-full h-full object-contain auto-remove-bg">
                                </div>
                                <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.2)_50%)] bg-[length:100%_4px] pointer-events-none"></div>
                                <div class="absolute bottom-0 left-0 bg-black text-white px-3 py-2 text-sm en-pixel border-tr-2 border-white">COACH.EXE</div>
                            </div>
                        </div>

                        <div id="video-controls" class="hidden w-full max-w-[400px] md:max-w-none mt-3 bg-gray-900 border-2 border-white p-3 flex items-center justify-center gap-4">
                            <button id="play-pause-btn" class="text-white text-sm en-pixel hover:text-yellow-400 flex items-center gap-2 trigger-sound">
                                <span>â–¶</span> PLAY
                            </button>
                        </div>
                        
                        <div class="w-full max-w-[400px] md:max-w-none mt-6 bg-gray-900 border-4 border-white outline outline-2 outline-black p-5 text-white font-mono text-base md:text-lg">
                            <p class="text-center text-yellow-300 border-b-2 border-dashed border-gray-600 pb-2 mb-4 en-pixel text-xl">ABILITY STATS</p>
                            <div class="mb-4">
                                <div class="flex justify-between mb-1">
                                    <span class="text-pink-400">PROFESSIONAL</span> <span id="val-professional">0/100</span>
                                </div>
                                <div class="h-4 bg-gray-700 border border-gray-500"><div id="bar-1" class="stat-bar-fill h-full bg-pink-500"></div></div>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between mb-1">
                                    <span class="text-blue-400">LEADERSHIP</span> <span id="val-leadership">0/100</span>
                                </div>
                                <div class="h-4 bg-gray-700 border border-gray-500"><div id="bar-2" class="stat-bar-fill h-full bg-blue-500"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-green-400">PASSION</span> <span id="val-passion">0/100</span>
                                </div>
                                <div class="h-4 bg-gray-700 border border-gray-500"><div id="bar-3" class="stat-bar-fill h-full bg-green-500"></div></div>
                            </div>
                        </div>
                    </div>

                    <div class="w-full md:w-1/2 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center gap-4 mb-6 border-b-4 border-black pb-4">
                                <div class="w-14 h-14 bg-yellow-400 border-4 border-black flex items-center justify-center text-3xl">ğŸ“‚</div>
                                <div class="overflow-hidden">
                                    <h2 id="detail-title" class="text-xl md:text-3xl font-bold text-black pixel-font leading-none truncate"></h2>
                                    <p class="text-sm md:text-base text-gray-600 en-pixel mt-2 font-bold">ID: <span id="company-id-display">001</span> // CLASS: CORP</p>
                                </div>
                            </div>

                            <div class="mb-8">
                                <div class="rpg-dialogue !bg-blue-800 !border-white min-h-[100px] md:min-h-[140px] p-6">
                                    <p class="text-yellow-300 text-sm md:text-base mb-2 en-pixel flex items-center gap-2">
                                        <span class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></span> MENTOR SAYS:
                                    </p>
                                    <div class="text-xl md:text-3xl font-bold leading-relaxed text-white">
                                        <span id="detail-quote"></span><span class="cursor-blink inline-block w-3 h-6 md:w-4 md:h-8 bg-white align-middle ml-1"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- ä¿®æ­£ï¼šä»‹ç´¹å€å¡Šé«˜åº¦æ“´å¢ h-64 md:h-96 -->
                            <div class="mb-8 bg-white p-4 md:p-6 border-4 border-dashed border-gray-400 relative shadow-sm h-64 md:h-96 overflow-y-auto custom-scroll">
                                <p id="detail-desc" class="text-gray-900 text-lg md:text-xl leading-loose text-justify whitespace-pre-line font-medium"></p>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row justify-between items-center gap-6 mt-auto pt-6 border-t-4 border-black">
                            <div class="flex items-center gap-4 w-full md:w-auto">
                                <div class="w-14 h-14 md:w-16 md:h-16 bg-gray-300 border-2 border-black rounded-full overflow-hidden flex-shrink-0">
                                    <img src="https://ui-avatars.com/api/?name=M&background=random" class="w-full h-full object-cover grayscale force-pixel" alt="Icon">
                                </div>
                                <div>
                                    <p class="text-xs md:text-sm text-gray-500 font-bold en-pixel">ASSIGNED MENTOR</p>
                                    <p id="detail-coach" class="font-bold text-lg md:text-2xl text-black"></p>
                                </div>
                            </div>
                            
                            <button onclick="goBack()" class="pixel-btn bg-red-500 text-white w-full md:w-auto hover:bg-red-600 hover:scale-105 transition-transform flex items-center justify-center gap-3 text-lg md:text-xl trigger-sound">
                                <span>â—€</span> RETURN TO MAP
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // --- 1. è³‡æ–™è¨­å®šå€ (24å®¶ä¼æ¥­ï¼Œå·²æ›´æ–°è³‡æ–™) ---
        const companies = [
            { id: 1, name: "å°ç£ç©é«”é›»è·¯è£½é€ (è‚¡)æœ‰é™å…¬å¸", shortName: "å°ç©é›» TSMC", coach: "è³‡æ·±ç¶“ç†", logo: "https://static.wixstatic.com/media/79893c_ea4516cec7a04affba07536f131c15c8%7Emv2_d_2248_1499_s_2.jpg/v1/fit/w_1000%2Ch_1000%2Cal_c%2Cq_80/file.png", coachImage: "./coach/01.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æºæ¥­å‹™å¤¥ä¼´è™•ç‡Ÿé‹çµ„ç¹”\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘å°ç©å…¬å¸æˆç«‹æ–¼1987å¹´ï¼Œç‡å…ˆé–‹å‰µäº†å°ˆæ¥­ç©é«”é›»è·¯è£½é€ æœå‹™ä¹‹å•†æ¥­æ¨¡å¼ï¼Œè‡ªæ­¤æˆç‚ºä¸–ç•Œé ˜å…ˆçš„å°ˆæ¥­ç©é«”é›»è·¯è£½é€ æœå‹™å…¬å¸ã€‚å°ç©å…¬å¸ä»¥é ˜å…ˆæ¥­ç•Œçš„è£½ç¨‹æŠ€è¡“åŠè¨­è¨ˆè§£æ±ºæ–¹æ¡ˆçµ„åˆæ”¯æ´å…¶å…¨çƒå®¢æˆ¶åŠå¤¥ä¼´ç”Ÿæ…‹ç³»çµ±çš„è“¬å‹ƒç™¼å±•ï¼Œé‡‹æ”¾å…¨çƒåŠå°é«”ç”¢æ¥­çš„å‰µæ–°ã€‚", quote: "å‰µæ–°æ˜¯æˆ‘å€‘çš„å‘½è„ˆï¼Œèª ä¿¡æ˜¯æˆ‘å€‘çš„åŸºçŸ³ã€‚", stats: { professional: 98, leadership: 90, passion: 85 } },
            { id: 2, name: "ä¸­åœ‹ä¿¡è¨—å•†æ¥­éŠ€è¡Œ(è‚¡)æœ‰é™å…¬å¸", shortName: "ä¸­åœ‹ä¿¡è¨—", coach: "å”ç†", logo: "https://osaas.commerce.nccu.edu.tw/uploads/media/14933719804.png", coachImage: "./coach/02.png", desc: "ã€éƒ¨é–€ã€‘ä¼æ¥­é‡‘èè™•\nã€åœ°é»ã€‘å°å—/é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ä¸­åœ‹ä¿¡è¨—å•†éŠ€æˆç«‹æ–¼1966å¹´ã€‚ç‡Ÿæ¥­é …ç›®åŒ…æ‹¬å­˜æ¬¾ã€æ”¾æ¬¾ã€ä¿è­‰ã€å¤–åŒ¯ã€åœ‹éš›é‡‘èæ¥­å‹™åˆ†è¡Œ(OBU)ã€ä¿¡è¨—ã€ä¿¡ç”¨å¡ã€ç¾é‡‘å¡ã€è­‰åˆ¸ã€å‚µåˆ¸ã€è¡ç”Ÿæ€§é‡‘èç”¢å“ç­‰ã€‚è‡´åŠ›æ–¼æä¾›åœ‹éš›åŒ–çš„é‡‘èæœå‹™ï¼Œæ˜¯å°ç£æœ€åœ‹éš›åŒ–çš„éŠ€è¡Œä¹‹ä¸€ã€‚", quote: "We are Familyï¼Œä¸åƒ…æ˜¯å£è™Ÿã€‚", stats: { professional: 92, leadership: 95, passion: 90 } },
            { id: 3, name: "è¯è¯é›»å­è‚¡ä»½æœ‰é™å…¬å¸", shortName: "è¯è¯é›»å­ UMC", coach: "è™•é•·", logo: "https://www.ioiotimes.com/wordpress/wp-content/uploads/2023/03/20230303-NEWS-313.jpg", coachImage: "./coach/03.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æºè™• / è™•é•·å®¤\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘è¯è¯é›»å­ç‚ºå…¨çƒåŠå°é«”æ™¶åœ“ä»£å·¥æ¥­ç•Œçš„é ˜å°è€…ï¼Œæä¾›é«˜å“è³ªçš„ç©é«”é›»è·¯è£½é€ æœå‹™ï¼Œå°ˆæ³¨æ–¼é‚è¼¯åŠç‰¹æ®ŠæŠ€è¡“ï¼Œç‚ºè·¨è¶Šé›»å­è¡Œæ¥­çš„å„é …ä¸»è¦æ‡‰ç”¨ç”¢å“ç”Ÿç”¢æ™¶ç‰‡ã€‚è¯é›»å®Œæ•´çš„è£½ç¨‹æŠ€è¡“åŠè£½é€ è§£æ±ºæ–¹æ¡ˆåŒ…æ‹¬é‚è¼¯/æ··åˆä¿¡è™Ÿã€åµŒå…¥å¼é«˜å£“è§£æ±ºæ–¹æ¡ˆç­‰ã€‚", quote: "ä»¥äººç‚ºæœ¬ï¼Œè¿½æ±‚å“è¶Šã€‚", stats: { professional: 90, leadership: 90, passion: 92 } },
            { id: 4, name: "çµ±ä¸€ä¼æ¥­è‚¡ä»½æœ‰é™å…¬å¸", shortName: "çµ±ä¸€ä¼æ¥­", coach: "è³‡æ·±ç¶“ç†", logo: "https://upload.wikimedia.org/wikipedia/zh/thumb/a/a2/Uni-President_Taiwan_logo.svg/250px-Uni-President_Taiwan_logo.svg.png", coachImage: "./coach/04.png", desc: "ã€éƒ¨é–€ã€‘ç¸½ç¶“ç†å®¤\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘çµ±ä¸€ä¼æ¥­è‡ª1967å¹´å‰µç«‹æ–¼è‡ºå—æ°¸åº·ï¼Œå …æŒã€Œä¸‰å¥½ä¸€å…¬é“ã€çš„ç¶“ç‡Ÿç†å¿µï¼ˆå“è³ªå¥½ã€ä¿¡ç”¨å¥½ã€æœå‹™å¥½ã€åƒ¹æ ¼å…¬é“ï¼‰ï¼Œå·²ç™¼å±•æˆç‚ºéä½ˆå…¨å³¶ã€è·¨è¶³å¤§é™¸ã€é‚å‘å…¨çƒçš„ç¶œåˆæ€§å¥åº·æœå‹™æ°‘ç”Ÿç”¢æ¥­é›†åœ˜ã€‚è‡´åŠ›æ–¼æå‡æ¶ˆè²»è€…çš„ç”Ÿæ´»å“è³ªã€‚", quote: "ä¸‰å¥½ä¸€å…¬é“ï¼Œèª å¯¦å‹¤é“ã€‚", stats: { professional: 95, leadership: 88, passion: 96 } },
            { id: 5, name: "ç’¨æšä¼æ¥­è‚¡ä»½æœ‰é™å…¬å¸", shortName: "ç’¨æšä¼æ¥­", coach: "ç¶“ç†", logo: "https://th.bing.com/th/id/OIP.zaQujUaoCI0M7U9iooauPQHaCh?w=323&h=119&c=7&r=0&o=7&pid=1.7&rm=3", coachImage: "./coach/05.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æºéƒ¨\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ç’¨æšä¼æ¥­å‰µç«‹æ–¼1981å¹´ï¼Œä½æ–¼å°å—å¸‚ç§‘æŠ€å·¥æ¥­å€ï¼Œç‚ºå°ç£æœ€å¤§çš„å¡è»Šæ‹–è»Šè»Šç‡ˆè£½é€ å» ã€‚ä¸‰åå¹´ä¾†ä¸æ–·å‰µæ–°èˆ‡ç ”ç™¼ï¼Œç”¢å“è¡ŒéŠ·éåŠä¸–ç•Œå„åœ°ã€‚ç§‰æŒã€ŒåŠ›è¡Œå“è³ªè‡³ä¸Šã€è¶…è¶Šé¡§å®¢æœŸæœ›ã€ä¹‹å“è³ªæ”¿ç­–ï¼Œä¸¦å–„ç›¡ç¤¾æœƒå…¬æ°‘è²¬ä»»ã€‚", quote: "é»äº®çš„ä¸åªæ˜¯è»Šç‡ˆï¼Œæ›´æ˜¯æ‰¿è«¾ã€‚", stats: { professional: 88, leadership: 85, passion: 98 } },
            { id: 6, name: "é›²å ±è‚¡ä»½æœ‰é™å…¬å¸", shortName: "é›²å ±", coach: "ç™¼è¡Œäººå…¼ç¸½ç·¨è¼¯", logo: "https://img1.wsimg.com/isteam/ip/ce835593-9f92-49a2-9039-43fe1df844fb/773790.jpg/:/rs=w:105,h:75,cg:true,m/cr=w:105,h:75/qt=q:95", coachImage: "./coach/06.png", desc: "ã€è·ç¨±ã€‘ç™¼è¡Œäººå…¼ç¸½ç·¨è¼¯\nã€åœ°é»ã€‘å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ã€Šé›²å ±(CloudExpress)ã€‹å®šä½ç‚ºåœ‹æœƒèˆ‡ç”¢æ¥­ä¹‹é–“çš„äº’å‹•æºé€šå¹³å°ï¼Œå”åŠ©ç”¢æ¥­ç•Œæ‰“é€ æ›´å®Œå‚™çš„æ³•è¦ç’°å¢ƒã€‚ç™¼è¡Œå°è±¡é–å®šæ±ºç­–èè‹±ï¼Œè‡´åŠ›ä¸²é€£æ”¿ç­–åˆ¶å®šèˆ‡ç”¢æ¥­ç™¼å±•ï¼Œæ‰“é€ èƒ½å¿«é€Ÿåæ˜ è¶¨å‹¢ã€æ»¾å‹•ä¿®æ­£è§€é»çš„åœ‹å®¶æ”¿ç¶“ç”¢æ¥­æ™ºè­˜å¼•æ“ã€‚", quote: "å‚³éçœŸå¯¦èˆ‡è§€é»ã€‚", stats: { professional: 94, leadership: 96, passion: 90 } },
            { id: 7, name: "ç¿”è‹±èå‰µè‚¡ä»½æœ‰é™å…¬å¸", shortName: "ç¿”è‹±èå‰µ", coach: "å‰¯ç¸½ç¶“ç†", logo: "https://nadaholdings.com/wp-content/uploads/2022/05/NADA-HOLDINGS_favicon-150x150.png", coachImage: "./coach/07.png", desc: "ã€è·ç¨±ã€‘å‰¯ç¸½ç¶“ç†\nã€åœ°é»ã€‘å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ç¿”è‹±èå‰µç”±æ™ºå¯¶åœ‹éš›èˆ‡æ–‡ç­–é™¢åˆè³‡æˆç«‹ï¼Œè‡´åŠ›æ–¼æ¨å‹•å°ç£åŸå‰µIPè¸ä¸Šåœ‹éš›èˆå°ã€‚é€éèˆ‡æ—¥æœ¬è£½ä½œã€ç™¼è¡Œå…¬å¸åˆä½œï¼Œå¼•é€²ç”¢æ¥­æŠ€è¡“èˆ‡äººæ‰äº¤æµï¼ŒæœŸè¨±ä½œç‚ºå°ã€æ—¥å‹•ç•«ç”¢æ¥­å°æ¥çš„å°ˆæ¥­æ©‹æ¨‘ï¼Œæ‰¶æ¤å°ç£IPæˆåŠŸç”¢è£½å‹•ç•«ä¸¦èºä¸Šåœ‹éš›ã€‚", quote: "æƒ³åƒåŠ›æ˜¯å‰µæ–°çš„èµ·é»ã€‚", stats: { professional: 90, leadership: 92, passion: 95 } },
            { id: 8, name: "ä¿¡ç¾©æˆ¿å±‹è‚¡ä»½æœ‰é™å…¬å¸", shortName: "ä¿¡ç¾©æˆ¿å±‹", coach: "å”ç†", logo: "https://tse4.mm.bing.net/th/id/OIP.19-3ZoZrnkCdXE4Y-8p41gHaD0?rs=1&pid=ImgDetMain&o=7&rm=3", coachImage: "./coach/08.png", desc: "ã€éƒ¨é–€ã€‘ä»²ä»‹ç‡Ÿé‹ä¸‰è™•\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ä¿¡ç¾©æˆ¿å±‹æˆç«‹æ–¼1981å¹´ï¼Œå …æŒã€Œä¿¡ç¾©ç«‹æ¥­ï¼Œæ­¢æ–¼è‡³å–„ã€çš„ç¶“ç‡Ÿç†å¿µã€‚é¦–å‰µã€Œä¸å‹•ç”¢èªªæ˜æ›¸ã€ï¼Œæ¨å‹•æˆ¿å±‹äº¤æ˜“é€æ˜åŒ–ã€‚è‡´åŠ›æ–¼æˆç‚ºå±…ä½ç”Ÿæ´»æœå‹™ç¬¬ä¸€å“ç‰Œï¼Œä¸¦ç©æ¥µæŠ•å…¥ESGèˆ‡ç¤¾å€ç‡Ÿé€ ï¼Œå¯¦è¸ã€Œå…ˆç¾©å¾Œåˆ©ã€çš„ä¼æ¥­ç²¾ç¥ã€‚", quote: "å…ˆç¾©å¾Œåˆ©ï¼Œç¾©åˆ©åˆä¸€ã€‚", stats: { professional: 91, leadership: 94, passion: 97 } },
            { id: 9, name: "è³‡èª è¯åˆæœƒè¨ˆå¸«äº‹å‹™æ‰€", shortName: "è³‡èª  PwC", coach: "å‰¯ç¸½/åŸ·æ¥­æœƒè¨ˆå¸«", logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/PricewaterhouseCoopers_Logo.svg", coachImage: "./coach/09.png", desc: "ã€éƒ¨é–€ã€‘å¯©è¨ˆ\nã€åœ°é»ã€‘å°å—/å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘è³‡èª (PwC Taiwan)ä¿‚ç”±æœ±åœ‹ç’‹åŠé™³æŒ¯éŠ‘æœƒè¨ˆå¸«æ–¼1970å¹´å‰µç«‹ï¼Œç‚ºPwCå…¨çƒè¯ç›Ÿæˆå“¡ã€‚æä¾›å¯©è¨ˆã€ç¨…å‹™ã€æŠ•è³‡ç†è²¡ã€åƒ¹å€¼ç®¡ç†ã€äººåŠ›è³‡æºç­‰æ•´åˆæ€§å°ˆæ¥­æœå‹™ã€‚é‹ç”¨å…¨çƒè³‡æºï¼Œå”åŠ©å®¢æˆ¶ç²¾æº–æŒæ¡ç¶“æ¿Ÿç”¢æ¥­è¶¨å‹¢ï¼Œæå‡ä¼æ¥­åƒ¹å€¼ã€‚", quote: "è§£æ±ºé‡è¦å•é¡Œï¼Œç‡Ÿé€ ç¤¾æœƒèª ä¿¡ã€‚", stats: { professional: 99, leadership: 85, passion: 88 } },
            { id: 10, name: "è¯æ³°é›»å­è‚¡ä»½æœ‰é™å…¬å¸", shortName: "è¯æ³°é›»å­ OSE", coach: "ç¶“ç†", logo: "https://sorting-house.com.tw/wp-content/uploads/2016/09/005-1.jpg", coachImage: "./coach/10.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æº\nã€åœ°é»ã€‘é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘è¯æ³°é›»å­å°ˆæ³¨æ–¼è¨˜æ†¶é«”ç”¢å“ï¼Œç‚ºå°ç£ç¬¬ä¸€å®¶å®Œå…¨å°è³‡çš„ICå°è£ä»£å·¥å» ï¼Œæ·±ç²è‚¯å®šã€‚è‡ª1971å¹´æˆç«‹ä»¥ä¾†ï¼Œé€éè£½ç¨‹å‰µæ–°èˆ‡æ ¸å¿ƒå„ªå‹¢ï¼Œæä¾›ç©é«”é›»è·¯å°è£èˆ‡æ¸¬è©¦è£½é€ æœå‹™(IC Packaging & Testing)åŠå°ˆæ¥­é›»å­ä»£å·¥è£½é€ æœå‹™(EMS)ã€‚", quote: "ç©©å¥è¸å¯¦ï¼Œç²¾ç›Šæ±‚ç²¾ã€‚", stats: { professional: 89, leadership: 88, passion: 90 } },
            { id: 11, name: "è£•éš†æ—¥ç”¢", shortName: "è£•éš†æ—¥ç”¢", coach: "ç¶“ç†", logo: "https://www.brandinlabs.com/wp-content/uploads/2020/03/%E6%96%B0LOGO%E7%B4%B0%E7%AF%80-1-950x475.png", coachImage: "./coach/11.png", desc: "ã€éƒ¨é–€ã€‘ç¸½ç®¡ç†è™• äººåŠ›è³‡æºéƒ¨\nã€åœ°é»ã€‘æ–°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘è£•éš†æ—¥ç”¢æ±½è»Šç©æ¥µå‰µé€ ç¬¦åˆå€åŸŸé¢¨æ ¼çš„å„ªå‹¢è»Šç¨®ï¼Œä¸¦å°‡å°ç£æ±½è»Šè¨­è¨ˆå¯¦åŠ›æ¨å‘å…¨çƒå¸‚å ´ã€‚æ­æ««ã€Œè¿½æ±‚é¡§å®¢æ»¿æ„ã€å‰µé€ ä¼æ¥­ç¹æ¦®ã€è²¢ç»ç¤¾æœƒç¦ç¥‰ã€ä¸‰å¤§ç¶“ç‡Ÿç†å¿µã€‚åœ¨è¨­è¨ˆã€ç ”ç™¼ã€è¡ŒéŠ·ã€æœå‹™ç­‰æ–¹é¢ï¼Œçš†ä»¥æé«˜é¡§å®¢æ»¿æ„ç‚ºæœ€çµ‚ç›®æ¨™ã€‚", quote: "äººè»Šç”Ÿæ´»ï¼Œå¤¢æƒ³å‰è¡Œã€‚", stats: { professional: 92, leadership: 90, passion: 93 } },
            { id: 12, name: "å°ç£åœ‹éš›èˆªé›»(Garmin)", shortName: "Garmin", coach: "è³‡æ·±å”ç†", logo: "https://campustalent.careercenter.ncu.edu.tw/storage/company_logo/23527104_logo.png", coachImage: "./coach/12.png", desc: "ã€éƒ¨é–€ã€‘ç¸½ç®¡ç†è™• äººåŠ›è³‡æºéƒ¨\nã€åœ°é»ã€‘æ¡ƒåœ’/å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘Garminæ˜¯å…¨çƒè¡›æ˜Ÿå®šä½ç³»çµ±(GPS)ç”¢æ¥­çš„é¾é ­ã€‚è‡ª1989å¹´æˆç«‹ä»¥ä¾†ï¼Œåœ¨èˆªç©ºã€èˆªæµ·ã€æˆ¶å¤–å¥èº«ã€æ±½è»Šå°èˆªç­‰é ˜åŸŸå…¨çƒå¸‚ä½”ç¬¬ä¸€ã€‚ç§‰æŒã€Œå‰µæ–°ç ”ç™¼ã€è±å¯Œå¤§å®¶ç”Ÿæ´»ã€çš„ç²¾ç¥ï¼Œä»¥ç”¢å“å¹«åŠ©è¨±å¤šäººå®Œæˆä¸åŒé ˜åŸŸçš„æ—…ç¨‹è¨˜æ†¶ã€‚", quote: "Beat Yesterday. è´éæ˜¨å¤©çš„è‡ªå·±ã€‚", stats: { professional: 96, leadership: 92, passion: 95 } },
            { id: 13, name: "æ°¸è±å•†æ¥­éŠ€è¡Œè‚¡ä»½æœ‰é™å…¬å¸", shortName: "æ°¸è±éŠ€è¡Œ", coach: "å‰¯è™•é•·", logo: "https://bank.sinopac.com/sinopacBT/webevents/1808_salarybuild/images/sinopac_logo_m.jpg", coachImage: "./coach/13.png", desc: "ã€éƒ¨é–€ã€‘æ•¸ä½é‡‘èè™•\nã€åœ°é»ã€‘å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘æ°¸è±éŠ€è¡Œç‚ºæ°¸è±é‡‘æ§å…¨è³‡å­å…¬å¸ï¼Œä»¥ç¶¿å¯†çš„ç‡Ÿæ¥­ç¶²çµ¡ã€é«˜åº¦å‰µæ–°çš„å•†å“çµ„åˆï¼Œç‚ºå®¢æˆ¶æä¾›æœ€ä½³é‡‘èæœå‹™ã€‚æ¥­å‹™ç¯„åœå«æ³•äººé‡‘èã€å€‹äººé‡‘èã€è²¡å¯Œç®¡ç†ç­‰ã€‚å±•æœ›åœ‹éš›ï¼ŒæŒçºŒå‰µæ–°ï¼Œè‡´åŠ›æ–¼ã€Œç¿»è½‰é‡‘èï¼Œå…±å‰µç¾å¥½ç”Ÿæ´»ã€ã€‚", quote: "ç¿»è½‰é‡‘èï¼Œå…±å‰µç¾å¥½ç”Ÿæ´»ã€‚", stats: { professional: 93, leadership: 89, passion: 94 } },
            { id: 14, name: "æ–°åŠ å¡å•†éˆ¦å¦ç§‘æŠ€", shortName: "éˆ¦å¦ç§‘æŠ€", coach: "éƒ¨é–€ä¸»ç®¡", logo: "https://tse2.mm.bing.net/th/id/OIP.6b9AFHqwYn7lYvNcF6yPKwHaC2?rs=1&pid=ImgDetMain&o=7&rm=3", coachImage: "./coach/14.png", desc: "ã€éƒ¨é–€ã€‘é–‹ç™¼éƒ¨é–€\nã€åœ°é»ã€‘é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘éˆ¦å¦ç§‘æŠ€æ˜¯ä¸€é–“ç¸½éƒ¨ä½æ–¼æ–°åŠ å¡çš„è»Ÿé«”é–‹ç™¼å…¬å¸ï¼Œå°ˆæ³¨æ–¼ç·šä¸Šè»Ÿé«”å¹³å°å®¢è£½é–‹ç™¼èˆ‡ç¶­è­·ã€‚æ¡ç”¨æ•æ·é–‹ç™¼(Agile)æ¨¡å¼ï¼Œé‡è¦–é€æ˜åº¦èˆ‡é–‹æ”¾æ€§ã€‚ç§‰æŒã€Œè¶…è¶Šè‡ªæˆ‘ Never Stop Improvingã€çš„ç†å¿µï¼Œæä¾›éˆæ´»æ‡‰è®Šçš„ç”¢å“è§£æ±ºæ–¹æ¡ˆã€‚", quote: "Never Stop Improving.", stats: { professional: 95, leadership: 95, passion: 100 } },
            { id: 15, name: "ç¾å•†è‹±ç‰¹æ ¼æœ‰é™å…¬å¸å°ç£åˆ†å…¬å¸", shortName: "è‹±ç‰¹æ ¼ Entegris", coach: "è³‡æ·±ç¶“ç†", logo: "https://mms.businesswire.com/media/20230510005102/zh-HK/804442/5/ENTG-logo-Businesswire.jpg?download=1", coachImage: "./coach/15.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æºéƒ¨é–€\nã€åœ°é»ã€‘é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘Entegrisæ˜¯åŠå°é«”èˆ‡å…¶ä»–é«˜ç§‘æŠ€ç”¢æ¥­çš„ç‰¹ç”¨åŒ–å­¸å“èˆ‡å…ˆé€²ææ–™è§£æ±ºæ–¹æ¡ˆé ˜å°ä¾›æ‡‰å•†ã€‚æ ¸å¿ƒç«¶çˆ­åŠ›å±•ç¾æ–¼ææ–™ç§‘å­¸ã€å¾®æ±¡æŸ“æ§åˆ¶ã€é«˜éšææ–™åŠå“è¶Šè£½é€ ã€‚å”åŠ©å®¢æˆ¶æå‡è‰¯ç‡ã€é™ä½æˆæœ¬ï¼Œç‚ºå…ˆé€²è£½ç¨‹æä¾›é—œéµæ”¯æ´ã€‚", quote: "Pure Advantage.", stats: { professional: 94, leadership: 88, passion: 90 } },
            { id: 16, name: "ç¾å•†ç§‘æ—ç ”ç™¼è‚¡ä»½æœ‰é™å…¬å¸", shortName: "ç§‘æ—ç ”ç™¼ Lam", coach: "è³‡æ·±ç‡Ÿé‹è™•é•·", logo: "https://www.tsia.org.tw/api/GetDownloadMemberInfoLogoJpg?id=11", coachImage: "./coach/16.png", desc: "ã€è·ç¨±ã€‘è³‡æ·±ç‡Ÿé‹è™•é•·\nã€åœ°é»ã€‘æ–°ç«¹\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘ç§‘æ—ç ”ç™¼(Lam Research)æ˜¯å…¨çƒå‰ä¸‰å¤§åŠå°é«”è¨­å‚™è£½é€ å•†ï¼Œç¸½éƒ¨ä½æ–¼ç¾åœ‹çŸ½è°·ã€‚å°ˆé–€ç”Ÿç”¢ã€è¨­è¨ˆã€éŠ·å”®åŠå°é«”è¨­å‚™ï¼ŒæŒæ¡è•åˆ»å’Œè–„è†œæ²‰ç©è£½ç¨‹çš„é—œéµæŠ€è¡“ã€‚æä¾›å…ˆé€²æŠ€è¡“èˆ‡æœå‹™çµ¦å„åœ‹åŠå°é«”æ¥­è€…ï¼Œé©…å‹•ç§‘æŠ€é€²æ­¥ã€‚", quote: "Prove it properly.", stats: { professional: 98, leadership: 95, passion: 85 } },
            { id: 17, name: "å°ç£æ©«æ¸ ç”¢å­¸è¯ç›Ÿ", shortName: "æ©«æ¸ ç”¢å­¸è¯ç›Ÿ", coach: "ç§˜æ›¸é•·", logo: "https://tse1.explicit.bing.net/th/id/OIP.64IygBmFyWqnP-p9hRDbHAAAAA?rs=1&pid=ImgDetMain&o=7&rm=3", coachImage: "./coach/17.png", desc: "ã€è·ç¨±ã€‘ç§˜æ›¸é•·\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘æ©«æ¸ ç”¢å­¸è¯ç›Ÿè‡´åŠ›æ–¼ç‚ºå°ç£æ‰“é€ ä»¥èƒ½åŠ›ç‚ºæ ¸å¿ƒçš„å¤§å­¸ç”¢æ¥­å‰µæ–°äººæ‰åŸ¹è‚²ç”Ÿæ…‹åœˆã€‚å°ˆæ³¨ç”¢æ¥­æ€ç¶­æ•™è‚²ï¼Œæå‡å­¸ç”Ÿè»Ÿå¯¦åŠ›ï¼Œä¸¦é€£çµå°ˆæ¥­å¤¥ä¼´ï¼Œä½¿æ‰€å­¸èƒ½æœ‰æ‰€ç”¨ã€‚ç§‰æŒã€Œéæ²³è¦æ­æ©‹ï¼Œé€ æ—è¦è‚²è‹—ã€çš„ç†å¿µï¼Œå…±å‰µç”¢å­¸åƒ¹å€¼ã€‚", quote: "é€£çµå­¸è¡“ç•Œèˆ‡ç”¢æ¥­ç•Œçš„æ©‹æ¨‘ã€‚", stats: { professional: 90, leadership: 98, passion: 95 } },
            { id: 18, name: "å°ç£è·æ¶¯ç™¼å±•å”æœƒ", shortName: "è·æ¶¯ç™¼å±•å”æœƒ", coach: "å¸¸å‹™ç›£äº‹", logo: "https://scontent.fkhh2-2.fna.fbcdn.net/v/t39.30808-6/515636081_24844157505202382_1289786258779538948_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=8erBvl39QLEQ7kNvwEW8DoZ&_nc_oc=AdkPkTuZQ75Lslr4ZoOsu1PLoZrnopAx4sfszTbT50r5eUvhGTD0TCD7WSC8AQ17avLsiCMNZg9SdLpvAM4EovE6&_nc_zt=23&_nc_ht=scontent.fkhh2-2.fna&_nc_gid=RoDFMxkTyaCSxcIOAFoR2Q&oh=00_Afl0VUy1ZUoJH9_3aI94NQn2IVUtd-ekf7jGtQC9wqJqcA&oe=69520F96", coachImage: "./coach/18.png", desc: "ã€è·ç¨±ã€‘å¸¸å‹™ç›£äº‹\nã€åœ°é»ã€‘å°å—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘å°ç£è·æ¶¯ç™¼å±•å”æœƒè‡´åŠ›æ–¼æ¨å»£æ­£ç¢ºçš„è·æ¶¯ç™¼å±•è§€å¿µï¼Œå”åŠ©å€‹äººæ¢ç´¢æ½›èƒ½ã€è¦åŠƒè·æ¶¯è·¯å¾‘ã€‚é€éèˆ‰è¾¦è¬›åº§ã€å·¥ä½œåŠèˆ‡è«®è©¢æœå‹™ï¼ŒåŸ¹è‚²å°ˆæ¥­è·æ¶¯è«®è©¢å¸«ï¼Œä¸¦é€£çµç”¢å­¸è³‡æºï¼Œå¹«åŠ©é’å¹´èˆ‡è½‰è·è€…åœ¨è·å ´é¦¬æ‹‰æ¾ä¸­æ‰¾åˆ°ç©©å¥å‰è¡Œçš„æ­¥ä¼ã€‚", quote: "è·æ¶¯æ˜¯å ´é¦¬æ‹‰æ¾ã€‚", stats: { professional: 92, leadership: 96, passion: 98 } },
            { id: 19, name: "å¡æšè³‡è¨Šè‚¡ä»½æœ‰é™å…¬å¸", shortName: "å¡æšè³‡è¨Š", coach: "è™•é•·", logo: "https://www.taiwanexcellence.org/upload/firm/logo/22425662.jpg", coachImage: "./coach/19.png", desc: "ã€éƒ¨é–€ã€‘ä¼åŠƒæš¨çµ„ç¹”ç™¼å±•ç¸½è™•\nã€åœ°é»ã€‘é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘å¡æšè³‡è¨Šç‚ºä¼æ¥­eåŒ–æ‡‰ç”¨è»Ÿé«”é–‹ç™¼èˆ‡æœå‹™é ˜å°å» å•†ã€‚æ¨å‡ºæ•¸ä½åŒ–è¾¦å…¬å·¥å…·ã€é›²ç«¯æœå‹™åŠAIæ™ºèƒ½å°è©±æœå‹™ç­‰ã€‚æ“æœ‰30å¤šå¹´çš„è³‡å®‰åŠæ™ºæ…§ç¶­é‹ç¶“é©—ï¼Œå”åŠ©å®¢æˆ¶æ¨å‹•æ•¸ä½è½‰å‹ã€‚ç§‰æŒã€Œå“è³ªèˆ‡åƒ¹å€¼ï¼Œæ‰¿è«¾å¿…é”ã€çš„ç²¾ç¥æœå‹™å®¢æˆ¶ã€‚", quote: "å“è³ªèˆ‡åƒ¹å€¼ï¼Œæ‰¿è«¾å¿…é”ã€‚", stats: { professional: 93, leadership: 90, passion: 90 } },
            { id: 20, name: "åˆè¯é›»ç¶²ç§‘æŠ€æœ‰é™å…¬å¸", shortName: "åˆè¯é›»ç¶²", coach: "ç¸½ç¶“ç†", logo: "https://www.taiwanarena.tech/upload/catalog_startups_list_pic/enL_catalog_startups_25E08_ZPJ2iZctNL.jpg", coachImage: "./coach/20.png", desc: "ã€è·ç¨±ã€‘ç¸½ç¶“ç†\nã€åœ°é»ã€‘å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘åˆè¯é›»ç¶²è‡´åŠ›æ–¼é›»åŠ›ç³»çµ±åˆ†æã€ç›£æ¸¬ã€ä¿è­·èˆ‡æ§åˆ¶ä»¥åŠæ™ºæ…§é›»ç¶²æ‡‰ç”¨ä¹‹è§£æ±ºæ–¹æ¡ˆã€‚ä»¥å¢é€²èƒ½æºä½¿ç”¨æ•ˆç‡ï¼Œä¸¦ç¢ºä¿é›»åŠ›ç³»çµ±ä¹‹å¯é åº¦èˆ‡ç©©å®šæ€§ç‚ºç›®æ¨™ã€‚æä¾›å°ˆæ¥­çš„é›»ç¶²æŠ€è¡“æœå‹™ï¼Œä¸²èµ·æ™ºæ…§èƒ½æºçš„æœªä¾†ã€‚", quote: "é€£çµèƒ½æºï¼Œä¸²èµ·æ™ºæ…§æœªä¾†ã€‚", stats: { professional: 95, leadership: 92, passion: 92 } },
            { id: 21, name: "å°ç£å„ªè¡£åº«æœ‰é™å…¬å¸(UNIQLO)", shortName: "UNIQLO", coach: "å¾…å®š", logo: "https://upload.wikimedia.org/wikipedia/commons/9/92/UNIQLO_logo.svg", coachImage: "./coach/21.png", desc: "ã€è·ç¨±/éƒ¨é–€ã€‘å¾…å®š\nã€åœ°é»ã€‘å°å—/å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘UNIQLOæ˜¯æ—¥æœ¬è¿…éŠ·æœ‰é™å…¬å¸(Fast Retailing)çš„æ ¸å¿ƒå“ç‰Œï¼Œå …æŒã€ŒLifeWearã€çš„å“ç‰Œç†å¿µã€‚é€éå„ªè³ªçš„æœè£ï¼Œæ”¹è®Šäººå€‘çš„ç”Ÿæ´»æ–¹å¼ã€‚è‡´åŠ›æ–¼æ”¹è®Šæœè£ã€æ”¹è®Šå¸¸è­˜ã€æ”¹è®Šä¸–ç•Œï¼Œæä¾›è®“æ‰€æœ‰äººç”Ÿæ´»æ›´ç¾å¥½çš„æ—¥å¸¸æœè£ã€‚", quote: "æ”¹è®Šæœè£ï¼Œæ”¹è®Šå¸¸è­˜ï¼Œæ”¹è®Šä¸–ç•Œã€‚", stats: { professional: 90, leadership: 90, passion: 95 } },
            { id: 22, name: "è‡»é¼ç§‘æŠ€é›†åœ˜", shortName: "è‡»é¼ç§‘æŠ€", coach: "ç¶“ç†", logo: "https://tse1.mm.bing.net/th/id/OIP.yaT0IfoDROpXrbL9ELLh8QAAAA?rs=1&pid=ImgDetMain&o=7&rm=3", coachImage: "./coach/22.png", desc: "ã€éƒ¨é–€ã€‘äººåŠ›è³‡æºéƒ¨\nã€åœ°é»ã€‘æ¡ƒåœ’/é«˜é›„\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘è‡»é¼ç§‘æŠ€é›†åœ˜æ˜¯å…¨çƒé ˜å…ˆçš„å°åˆ·é›»è·¯æ¿(PCB)è£½é€ å•†ã€‚æä¾›è¨­è¨ˆã€ç ”ç™¼ã€è£½é€ ã€éŠ·å”®ä¸€ç«™å¼è³¼è¶³çš„å…¨æ–¹ä½è§£æ±ºæ–¹æ¡ˆã€‚ç”¢å“å»£æ³›æ‡‰ç”¨æ–¼é›»è…¦ã€é€šè¨Šã€æ¶ˆè²»æ€§é›»å­ã€è»Šç”¨é›»å­ç­‰é ˜åŸŸã€‚ç§‰æŒã€Œç™¼å±•ç§‘æŠ€ï¼Œé€ ç¦äººé¡ã€çš„ä½¿å‘½ã€‚", quote: "ç™¼å±•ç§‘æŠ€ï¼Œé€ ç¦äººé¡ã€‚", stats: { professional: 94, leadership: 89, passion: 91 } },
            { id: 23, name: "å‚³æŒ¯ä¼æ¥­ç®¡ç†é¡§å•è‚¡ä»½æœ‰é™å…¬å¸", shortName: "å¡å…§åŸºè¨“ç·´", coach: "å‰¯ç¸½ç¶“ç†", logo: "https://www.carnegie.com.tw/lib/img/carnegie-logo3.png", coachImage: "./coach/23.png", desc: "ã€å‚™è¨»ã€‘å¡å…§åŸºè¨“ç·´\nã€åœ°é»ã€‘å°åŒ—\n\nã€ä¼æ¥­ä»‹ç´¹ã€‘å¡å…§åŸºè¨“ç·´æ˜¯å…¨çƒçŸ¥åçš„äººéš›é—œä¿‚èˆ‡æºé€šè¨“ç·´æ©Ÿæ§‹ã€‚è‡´åŠ›æ–¼å¹«åŠ©å€‹äººèˆ‡ä¼æ¥­ç™¼æ®æ½›èƒ½ï¼Œæå‡æºé€šèƒ½åŠ›ã€é ˜å°åŠ›ã€éŠ·å”®åŠ›èˆ‡ç°¡å ±æŠ€å·§ã€‚æ·±ä¿¡ã€ŒæˆåŠŸ85%å–æ±ºæ–¼äººéš›æºé€šã€ï¼Œå”åŠ©å­¸å“¡å¢å¼·è‡ªä¿¡ï¼Œå»ºç«‹è‰¯å¥½çš„äººéš›é—œä¿‚ã€‚", quote: "æˆåŠŸ85%å–æ±ºæ–¼äººéš›æºé€šã€‚", stats: { professional: 98, leadership: 98, passion: 98 } },
            { id: 24, name: "è·æ¶¯æ•™ç·´-å€‹äººçµ„", shortName: "å€‹äººçµ„", coach: "è·æ¶¯æ•™ç·´", logo: "https://placehold.co/600x300/fff/525252?text=Personal+Coach", coachImage: "./coach/24.png", desc: "ã€é¡åˆ¥ã€‘è·æ¶¯æ•™ç·´-å€‹äººçµ„\n\nã€ä»‹ç´¹ã€‘é€™è£¡åŒ¯èšäº†ä¾†è‡ªä¸åŒé ˜åŸŸçš„å°ˆæ¥­è·æ¶¯æ•™ç·´ï¼Œæä¾›ä¸€å°ä¸€çš„è«®è©¢èˆ‡æŒ‡å°ã€‚å”åŠ©ä½ èªè­˜è‡ªå·±ã€æ¢ç´¢è·æ¶¯æ–¹å‘ã€å„ªåŒ–å±¥æ­·é¢è©¦æŠ€å·§ï¼Œä¸¦é™ªä¼´ä½ åœ¨è·æ¶¯ç™¼å±•çš„é“è·¯ä¸Šï¼Œè·¨è¶ŠæŒ‘æˆ°ï¼Œå¯¦ç¾è‡ªæˆ‘åƒ¹å€¼ã€‚", quote: "èªè­˜è‡ªå·±ï¼Œæ˜¯è·æ¶¯ç™¼å±•çš„ç¬¬ä¸€æ­¥ã€‚", stats: { professional: 95, leadership: 95, passion: 100 } }
        ];

        // --- 2. ç¨‹å¼é‚è¼¯å€ ---

        const loadingScreen = document.getElementById('loading-screen');
        const startScreen = document.getElementById('start-screen');
        const mainMap = document.getElementById('main-map');
        const detailScreen = document.getElementById('detail-screen');
        const gridContainer = document.getElementById('grid-container');
        const bgmControl = document.getElementById('bgm-control');
        const gachaScreen = document.getElementById('gacha-screen');
        const gachaFolder = document.getElementById('gacha-folder');
        const gachaReveal = document.getElementById('gacha-reveal');
        const revealCard = document.getElementById('reveal-card');
        const revealImg = document.getElementById('reveal-img');
        const globalBg = document.getElementById('global-bg');
        const bossStage = document.getElementById('boss-stage');

        // éŸ³æ¨‚è¨­å®š
        const normalBGM = new Audio("./music/Pixels.mp3"); 
        normalBGM.loop = true; 
        normalBGM.volume = 0.5;

        const bossBGM = new Audio("./music/BossBattle.mp3"); 
        bossBGM.loop = true;
        bossBGM.volume = 0.6;

        let currentBGM = normalBGM;
        let isMusicPlaying = false;
        let hasEncounteredBoss = false; 

        // éŸ³æ•ˆåˆæˆå™¨
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playBeep(frequency = 440, type = 'square', duration = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = frequency;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        // BOSS å‡ºå ´éŸ³æ•ˆ
        function playBossIntroSound() {
            playBeep(100, 'sawtooth', 0.5);
            setTimeout(() => playBeep(80, 'sawtooth', 0.5), 400);
            setTimeout(() => playBeep(60, 'sawtooth', 1.0), 800);
        }

        // æ´—ç‰ŒéŸ³æ•ˆ
        function playShuffleSound() {
            playBeep(800, 'triangle', 0.05);
        }

        // æŠ½å¡éŸ³æ•ˆ
        function playGachaSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime + 0.8);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.8);
            osc.stop(audioCtx.currentTime + 0.8);
            setTimeout(() => playBeep(1500, 'square', 0.3), 800);
        }

        function attachSoundEffects() {
            document.querySelectorAll('.company-grid-item, .pixel-btn, button, .trigger-sound, .close-btn, .gacha-folder, .boss-grid-item').forEach(el => {
                el.addEventListener('mouseenter', () => playBeep(800, 'sine', 0.05));
            });
            document.querySelectorAll('.company-grid-item, .pixel-btn, button, .trigger-sound, .close-btn').forEach(el => {
                el.addEventListener('click', () => playBeep(440, 'square', 0.1));
            });
        }

        function toggleBGM() {
            const bgmStatus = document.getElementById('bgm-status');
            if (isMusicPlaying) {
                currentBGM.pause();
                isMusicPlaying = false;
                bgmStatus.innerText = "BGM: OFF";
            } else {
                currentBGM.play().catch(e => console.log("BGM play failed:", e));
                isMusicPlaying = true;
                bgmStatus.innerText = "BGM: ON";
            }
        }

        function switchBGM(newBGM) {
            if (currentBGM === newBGM) return; 

            const wasPlaying = isMusicPlaying;
            currentBGM.pause();
            currentBGM.currentTime = 0; 

            currentBGM = newBGM;
            if (wasPlaying) {
                currentBGM.play().catch(e => console.log("BGM switch failed:", e));
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function simulateLoading() {
            const fill = document.getElementById('loading-fill');
            const text = document.getElementById('loading-text');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                fill.style.width = `${progress}%`;
                if (progress < 30) text.innerText = "LOADING ASSETS...";
                else if (progress < 60) text.innerText = "GENERATING PIXELS...";
                else if (progress < 90) text.innerText = "SUMMONING COACHES...";
                else text.innerText = "READY!";
                if (progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.style.opacity = 0;
                        setTimeout(() => {
                            loadingScreen.classList.add('hidden-screen');
                            startScreen.classList.remove('hidden-screen');
                            attachSoundEffects();
                        }, 500);
                    }, 500);
                }
            }, 100);
        }

        function renderGrid() {
            gridContainer.innerHTML = '';
            companies.forEach(company => {
                const card = document.createElement('div');
                card.className = 'company-grid-item flex flex-col items-center p-2';
                card.onclick = () => showDetail(company.id); 
                card.innerHTML = `
                    <div class="w-full aspect-video bg-white border-2 border-black overflow-hidden relative flex items-center justify-center mb-2">
                        <img src="${company.logo}" alt="${company.name}" class="w-full h-full object-contain p-2">
                        <div class="absolute bottom-0 right-0 bg-yellow-400 text-black text-[10px] px-1 border-tl border-black font-bold en-pixel">LV.MAX</div>
                    </div>
                    <div class="text-center w-full">
                        <h3 class="font-bold text-xs md:text-sm pixel-font truncate px-1 text-black">${company.shortName || company.name}</h3>
                    </div>
                `;
                gridContainer.appendChild(card);
            });
            attachSoundEffects();
        }

        function startGame() {
            toggleBGM(); 
            bgmControl.classList.remove('hidden');
            startScreen.classList.add('hidden-screen');
            mainMap.classList.remove('hidden-screen');
            mainMap.style.opacity = 0;
            setTimeout(() => {
                mainMap.style.transition = 'opacity 1s';
                mainMap.style.opacity = 1;
            }, 50);
            
            // å•Ÿå‹• Boss æˆ°åµæ¸¬å™¨
            initBossObserver();
        }

        // --- Gacha é‚è¼¯ ---
        let currentSelectedId = null;
        let isGachaOpening = false;
        const visitedCompanies = new Set();

        function showDetail(id) {
            currentSelectedId = id;
            if (!visitedCompanies.has(id)) {
                visitedCompanies.add(id);
                gachaScreen.classList.remove('hidden-screen');
                gachaFolder.className = 'gacha-folder gacha-idle';
                gachaFolder.style.opacity = 1;
                isGachaOpening = false;
            } else {
                renderDetail(id);
            }
        }

        function triggerGacha() {
            if (isGachaOpening) return;
            isGachaOpening = true;
            playGachaSound();
            gachaFolder.className = 'gacha-folder gacha-shake gacha-flash';
            setTimeout(() => {
                gachaScreen.classList.add('hidden-screen'); 
                showShinyReveal(currentSelectedId); 
            }, 600); 
        }
        
        function showShinyReveal(id) {
            const company = companies.find(c => c.id === id);
            if (!company) return;
            gachaReveal.classList.remove('hidden-screen');
            revealImg.src = company.coachImage; 
            setTimeout(() => {
                document.querySelector('.sunburst').style.opacity = 1;
                revealCard.style.transform = 'scale(1.2)';
                revealCard.style.opacity = 1;
            }, 100);
            setTimeout(() => {
                gachaReveal.classList.add('hidden-screen');
                document.querySelector('.sunburst').style.opacity = 0;
                revealCard.style.transform = 'scale(0)';
                revealCard.style.opacity = 0;
                renderDetail(id);
            }, 2500);
        }

        function renderDetail(id) {
            const company = companies.find(c => c.id === id);
            if (!company) return;
            document.getElementById('detail-title').innerText = company.name;
            document.getElementById('company-id-display').innerText = String(company.id).padStart(3, '0');
            document.getElementById('detail-desc').innerText = company.desc;
            document.getElementById('detail-coach').innerText = company.coach;
            const stats = company.stats || { professional: 90, leadership: 90, passion: 90 };
            document.getElementById('val-professional').innerText = `${stats.professional}/100`;
            document.getElementById('val-leadership').innerText = `${stats.leadership}/100`;
            document.getElementById('val-passion').innerText = `${stats.passion}/100`;
            const mediaContainer = document.getElementById('media-container');
            const videoControls = document.getElementById('video-controls');
            const playPauseBtn = document.getElementById('play-pause-btn');

            if (company.coachImage.endsWith('.mp4')) {
                mediaContainer.innerHTML = `
                    <video id="coach-video" class="w-full h-full object-cover" autoplay loop muted playsinline>
                        <source src="${company.coachImage}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                `;
                videoControls.classList.remove('hidden');
                const videoElement = document.getElementById('coach-video');
                playPauseBtn.onclick = function() {
                    playBeep(440, 'square', 0.1);
                    if (videoElement.paused) {
                        videoElement.play();
                        playPauseBtn.innerHTML = '<span>â–¶</span> PLAYING';
                    } else {
                        videoElement.pause();
                        playPauseBtn.innerHTML = '<span>â¸</span> PAUSED';
                    }
                };
            } else {
                mediaContainer.innerHTML = `
                    <img id="detail-img" src="${company.coachImage}" alt="Coach Card" class="w-full h-full object-contain auto-remove-bg">
                `;
                videoControls.classList.add('hidden');
            }
            resetBars();
            detailScreen.classList.remove('hidden-screen');
            document.body.style.overflow = 'hidden';
            const quoteText = company.quote || "å‹‡å¾€ç›´å‰ï¼Œæ¢ç´¢æœªçŸ¥çš„è·æ¶¯é ˜åŸŸï¼";
            typeWriter(`ã€Œ${quoteText}ã€`, 'detail-quote', 40);
            animateBars(stats);
        }

        let typeInterval;
        function typeWriter(text, elementId, speed = 50) {
            const element = document.getElementById(elementId);
            element.innerHTML = "";
            let i = 0;
            clearInterval(typeInterval); 
            typeInterval = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    if (i % 3 === 0) playBeep(200, 'triangle', 0.05);
                } else {
                    clearInterval(typeInterval);
                }
            }, speed);
        }

        function resetBars() {
            document.querySelectorAll('.stat-bar-fill').forEach(bar => { bar.style.width = '0%'; });
        }

        function animateBars(stats) {
            setTimeout(() => {
                document.getElementById('bar-1').style.width = `${stats.professional}%`;
                document.getElementById('bar-2').style.width = `${stats.leadership}%`;
                document.getElementById('bar-3').style.width = `${stats.passion}%`;
            }, 300);
        }

        function goBack() {
            const videoElement = document.getElementById('coach-video');
            if (videoElement) { videoElement.pause(); }
            detailScreen.classList.add('hidden-screen');
            document.body.style.overflow = 'auto';
            clearInterval(typeInterval);
        }

        // ==========================================
        // === 3. BOSS æˆ°é¬¥ç³»çµ±å¯¦ä½œ (éš¨æ©Ÿæ´—ç‰Œç‰ˆ) ===
        // ==========================================

        let bossHP = 24;
        let currentTargetBlock = null;

        const questions = [
            "1.åœ¨è·å ´ä¸­æ–°é®®äººæœ€å¸¸çŠ¯çš„ã€Œè‡´å‘½éŒ¯èª¤ã€æ˜¯ä»€éº¼ï¼Ÿ",
            "2.æˆ‘è©²å¦‚ä½•åœ¨å±¥æ­·ä¸Šå±•ç¾äº®é»ä¾†å¸å¼•äººè³‡æ³¨æ„ï¼Ÿ",
            "3.é¢è©¦ä¸­å•ä»€éº¼æ¨£çš„å•é¡Œï¼Œæœ€èƒ½å±•ç¾æˆ‘çš„ç©æ¥µæ…‹åº¦ï¼Ÿ",
            "4.èº«ç‚ºè·å ´æ–°é®®äººï¼Œæˆ‘æœ‰è³‡æ ¼è«‡è–ªæ°´å—ï¼Ÿ",
            "5.å¦‚æœæˆ‘æƒ³æ‡‰å¾µèˆ‡æˆ‘ç§‘ç³»ç„¡é—œçš„å·¥ä½œï¼Œæˆ‘è©²å¦‚ä½•èªªæœä¼æ¥­æˆ‘å…·å‚™å‹ä»»é€™ä»½å·¥ä½œçš„æ½›åŠ›ï¼Ÿ",
            "6.åœ¨ç¬¬ä¸€ä»½å·¥ä½œä¸­ï¼Œæ‚¨èªç‚ºã€Œç¡¬å¯¦åŠ›ã€èˆ‡ã€Œè»Ÿå¯¦åŠ›ã€å“ªä¸€å€‹æ¯”è¼ƒé‡è¦ï¼Ÿ",
            "7.æ‚¨èªç‚ºç¾ä»£è·å ´ä¸­ï¼Œæœ€èƒ½è®“æ–°äººè„«ç©è€Œå‡ºçš„è»Ÿå¯¦åŠ›æ˜¯ä»€éº¼ï¼Ÿ",
            "8.è‹±æ–‡èƒ½åœ¨å¯¦éš›å·¥ä½œä¸­ï¼ŒçœŸçš„æœƒé »ç¹ç”¨åˆ°å—ï¼Ÿé‚„æ˜¯é€™åªæ˜¯ä¸€å€‹ç¯©é¸é–€æª»ï¼Ÿ",
            "9.ç”Ÿæˆå¼ AIï¼ˆå¦‚ ChatGPTï¼‰ è¶Šä¾†è¶Šæ™®åŠï¼Œæ‚¨å»ºè­°æ–°é®®äººè©²å¦‚ä½•åŸ¹é¤Šã€Œä¸è¢« AI å–ä»£ã€çš„èƒ½åŠ›ï¼Ÿ",
            "10.è·å ´ä¸Šå¸¸å¼·èª¿ã€Œé‚è¼¯æ€è€ƒã€å’Œã€Œè§£æ±ºå•é¡Œçš„èƒ½åŠ›ã€ï¼Œèƒ½å¦èˆ‰ä¸€å€‹å…·é«”çš„ä¾‹å­èªªæ˜é€™åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Ÿ",
            "11.ä½œç‚ºèœé³¥ï¼Œæˆ‘åœ¨æœƒè­°ä¸­å¸¸å¸¸ä¸æ•¢ç™¼è¨€æˆ–æ€•èªªéŒ¯è©±ï¼Œæˆ‘è©²å¦‚ä½•å…‹æœé€™ç¨®ææ‡¼ä¸¦é©æ™‚å±•ç¾è‡ªå·±ï¼Ÿ",
            "12.é‡åˆ°ä¸æœƒçš„å•é¡Œæ™‚ï¼Œæˆ‘å¾ˆæ€•ä¸€ç›´å•æœƒè¢«å«Œç…©æˆ–è¦ºå¾—èƒ½åŠ›å·®ï¼Œä½†ä¸å•åˆå¡ä½ï¼Œè«‹å•è©²å¦‚ä½•æ‹¿æã€Œç™¼å•ã€çš„æ™‚æ©Ÿèˆ‡æŠ€å·§ï¼Ÿ",
            "13.å¦‚æœé‡åˆ°è§€å¿µæ¯”è¼ƒå‚³çµ±çš„ä¸»ç®¡ï¼Œæˆ–æ˜¯æºé€šé »ç‡å°ä¸ä¸Šçš„å‰è¼©ï¼Œæˆ‘æœ‰ä»€éº¼æ–¹æ³•å¯ä»¥é †æš¢åœ°èˆ‡ä»–å€‘åˆä½œï¼Ÿ",
            "14.è·å ´ä¸ŠçœŸçš„èƒ½äº¤åˆ°æœ‹å‹å—ï¼Ÿé‚„æ˜¯æ‡‰è©²èˆ‡åŒäº‹ä¿æŒã€Œå…¬äº‹å…¬è¾¦ã€çš„è·é›¢æ¯”è¼ƒå®‰å…¨ï¼Ÿ",
            "15.å¦‚æœæˆ‘ä¸å°å¿ƒå¾—ç½ªäº†åŒäº‹ï¼Œæˆ–æ˜¯èˆ‡åœ˜éšŠæˆå“¡æ„è¦‹ä¸åˆï¼Œç•¶ä¸‹æˆ‘è©²å¦‚ä½•åœ“å ´æˆ–åŒ–è§£å°·å°¬ï¼Ÿ",
            "16.å°æ–¼ç¬¬ä¸€ä»½å·¥ä½œï¼Œæ‚¨æœƒå»ºè­°å…ˆå»åˆ¶åº¦å®Œå–„çš„å¤§å…¬å¸æ­·ç·´ï¼Œé‚„æ˜¯å»å……æ»¿æŒ‘æˆ°èˆ‡å½ˆæ€§çš„æ–°å‰µå…¬å¸ï¼Ÿ",
            "17.å¦‚ä½•å¿«é€Ÿè§€å¯Ÿä¸¦èå…¥ç•¶åœ°çš„ã€Œä¼æ¥­æ–‡åŒ–ã€æˆ–ã€Œæ½›è¦å‰‡ã€ï¼Ÿ",
            "18.å¦‚æœèƒ½å›åˆ°å‰›ç•¢æ¥­çš„é‚£ä¸€å¹´ï¼Œæ‚¨æœ€æƒ³å°ç•¶æ™‚æº–å‚™è¸å…¥è·å ´çš„è‡ªå·±èªªçš„ä¸€å¥è©±æ˜¯ä»€éº¼ï¼Ÿ",
            "19.å¦‚ä½•å¹³è¡¡å·¥ä½œè¡¨ç¾èˆ‡å€‹äººç”Ÿæ´»ï¼Ÿ",
            "20.åœ¨è©¦ç”¨æœŸæœŸé–“ï¼Œä¼æ¥­æœ€çœ‹é‡çš„æ˜¯ä»€éº¼ï¼Ÿ",
            "21.å‰›å…¥è·æ™‚å¸¸è¦ºå¾—è‡ªå·±ä»€éº¼éƒ½ä¸æœƒï¼Œé€™ç¨®ç„¦æ…®æ„Ÿè©²å¦‚ä½•æ’è§£ï¼Ÿ",
            "22.åœ¨å·¥ä½œä¸­çŠ¯äº†ä¸€å€‹æ¯”è¼ƒåš´é‡çš„éŒ¯èª¤ï¼Œèƒ½åšä»€éº¼ä¾†æŒ½å›ï¼Ÿ",
            "23.ç¬¬ä¸€ä»½å·¥ä½œå»ºè­°è‡³å°‘è¦åšå¤šä¹…ï¼Ÿ",
            "24.æ–°äººæ‡‰è©²å…ˆå°ˆæ³¨æœ¬æ¥­ï¼Œé‚„æ˜¯å¯ä»¥åˆ©ç”¨ä¸‹ç­æ™‚é–“ç™¼å±•å‰¯æ¥­ï¼Ÿ"
        ];

        // äº‚ç¢¼å­—å…ƒåº«
        const scrambleChars = "!@#$%^&*()_+{}|:<>?ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

        // åˆå§‹åŒ– Boss æˆ°ç›£è½å™¨
        function initBossObserver() {
            const target = document.getElementById('boss-stage'); 
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        enterBossMode();
                    } else {
                        exitBossMode();
                    }
                });
            }, { threshold: 0.1 }); 

            observer.observe(target);
            renderBossGrid();
        }

        function enterBossMode() {
            globalBg.classList.add('boss-mode');
            bossStage.style.opacity = 1;
            bossStage.style.filter = "grayscale(0)";
            
            if (!hasEncounteredBoss) {
                playBossIntroSound();
                hasEncounteredBoss = true;
                setTimeout(() => {
                    switchBGM(bossBGM);
                }, 1000); 
            } else {
                switchBGM(bossBGM);
            }
        }

        function exitBossMode() {
            globalBg.classList.remove('boss-mode');
            bossStage.style.opacity = 0.5;
            bossStage.style.filter = "grayscale(1)";
            switchBGM(normalBGM);
        }

        function renderBossGrid() {
            const grid = document.getElementById('boss-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const block = document.createElement('button');
                block.className = 'boss-grid-item';
                block.innerText = i + 1;
                block.dataset.index = i;
                block.onclick = (e) => openQuestion(e.target);
                grid.appendChild(block);
            }
        }

        // ä¿®æ”¹ï¼šåŠ å…¥æ´—ç‰Œç‰¹æ•ˆ
        let shuffleInterval;
        function openQuestion(block) {
            if (block.classList.contains('cleared')) return;
            currentTargetBlock = block;
            
            const modal = document.getElementById('question-modal');
            const qText = document.getElementById('q-text');
            const attackBtn = document.getElementById('attack-btn');
            
            modal.classList.remove('hidden');
            
            // æš«æ™‚ç¦ç”¨æ”»æ“ŠæŒ‰éˆ•
            attackBtn.disabled = true;
            attackBtn.classList.add('opacity-50', 'cursor-not-allowed');

            const targetIndex = parseInt(block.dataset.index);
            const finalQuestion = questions[targetIndex] || "ERROR: DATA NOT FOUND";
            
            // é–‹å§‹æ´—ç‰Œ
            qText.classList.add('shuffling');
            let shuffleCount = 0;
            const maxShuffles = 20; // æ´—ç‰Œæ¬¡æ•¸

            clearInterval(shuffleInterval);
            shuffleInterval = setInterval(() => {
                // 1. éš¨æ©Ÿé¡¯ç¤ºä¸€å€‹å•é¡Œ (æ¨¡æ“¬å¿«é€Ÿåˆ‡æ›)
                const randomQ = questions[Math.floor(Math.random() * questions.length)];
                // 2. æˆ–è€…é¡¯ç¤ºäº‚ç¢¼
                // const randomStr = Array(20).fill(0).map(() => scrambleChars[Math.floor(Math.random() * scrambleChars.length)]).join('');
                
                qText.innerText = randomQ;
                playShuffleSound(); // æ’­æ”¾çŸ­ä¿ƒéŸ³æ•ˆ

                shuffleCount++;
                if (shuffleCount >= maxShuffles) {
                    clearInterval(shuffleInterval);
                    finalizeQuestion(finalQuestion);
                }
            }, 60); // æ¯ 60ms åˆ‡æ›ä¸€æ¬¡
        }

        function finalizeQuestion(text) {
            const qText = document.getElementById('q-text');
            const attackBtn = document.getElementById('attack-btn');
            
            qText.innerText = text;
            qText.classList.remove('shuffling');
            
            // æ’­æ”¾é–å®šéŸ³æ•ˆ
            playBeep(1200, 'sine', 0.2); 
            
            // å•Ÿç”¨æ”»æ“ŠæŒ‰éˆ•
            attackBtn.disabled = false;
            attackBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function closeQuestionModal() {
            document.getElementById('question-modal').classList.add('hidden');
            clearInterval(shuffleInterval); // ç¢ºä¿é—œé–‰æ™‚åœæ­¢æ´—ç‰Œ
        }

        function triggerDamageEffect() {
            playBeep(150, 'sawtooth', 0.1); 
            setTimeout(() => playBeep(50, 'square', 0.4), 50); 

            globalBg.classList.add('damage-mode');
            setTimeout(() => {
                globalBg.classList.remove('damage-mode');
            }, 200);
        }

        function submitAttack() {
            triggerDamageEffect();
            
            bossHP--;
            updateBossHPUI();
            
            if (currentTargetBlock) {
                currentTargetBlock.classList.add('cleared');
                currentTargetBlock.innerText = "";
            }

            closeQuestionModal();

            if (bossHP <= 0) {
                setTimeout(triggerVictory, 1000); 
            }
        }

        function updateBossHPUI() {
            const hpBar = document.getElementById('boss-hp-bar');
            const hpText = document.getElementById('boss-hp-text');
            const percentage = (bossHP / 24) * 100;
            
            hpBar.style.width = `${percentage}%`;
            hpText.innerText = `${bossHP}/24`;
            
            bossStage.style.transform = "translate(5px, 5px)";
            setTimeout(() => bossStage.style.transform = "translate(0, 0)", 100);
        }

        function triggerVictory() {
            const victoryScreen = document.getElementById('victory-screen');
            victoryScreen.classList.remove('hidden');
            
            switchBGM(normalBGM); 

            const notes = [523, 523, 523, 523, 415, 466, 523, 466, 523];
            let delay = 0;
            notes.forEach((note, index) => {
                setTimeout(() => playBeep(note, 'square', 0.15), delay);
                delay += (index === 3) ? 400 : 150;
            });

            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 2000 };

            const randomInRange = (min, max) => Math.random() * (max - min) + min;

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        renderGrid();
        window.onload = simulateLoading;

    </script>
</body>
</html>
